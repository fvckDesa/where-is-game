import{u as H}from"./useGameImage.ad0bd41c.js";import{b as W,r as l,c as B,d as u,n as J,j as a,P as K,h as M,S as Q,C,o as T,p as V,q as X,t as Y}from"./index.20a8e46f.js";import{w as Z}from"./withAuth.4099624d.js";const _="/where-is-game/assets/Image.27eaf308.svg",ee="/where-is-game/assets/imageIllustration.062f45da.svg",re={name:"",coords:{x:null,y:null},image:{file:null,url:""}};function ae(){var I,R;const{user:k}=W(),[i,h]=l.exports.useState({message:"Error",type:"",isLunching:null}),[m,$]=l.exports.useState(0),[c,y]=l.exports.useState(new Array(3).fill({...re})),[n,v]=l.exports.useState({file:null,url:""}),w=l.exports.useRef(),[d,j]=l.exports.useState(""),{x:g,y:p,setCoords:x,containerRef:N,imageRef:b}=H(c[m]),E=B();l.exports.useEffect(()=>()=>URL.revokeObjectURL(n.url),[n.file]),l.exports.useEffect(()=>{h(e=>({...e,type:"",isLunching:null}))},[n.file,d,c]);function S(){w.current.click()}function U(e){const r=e.target.files[0];!r||v({file:r,url:URL.createObjectURL(r)})}function A(e){m!=null&&n.url&&(y(r=>r.map((t,s)=>s!==m?t:{...t,coords:e})),x(e))}function G(e){x(e)}function O(e){return function(r){y(t=>t.map((s,o)=>o!==e?s:{...s,...r}))}}function D(e){return function(r){$(e),x(r)}}function P(){let e=null;if(!n.file)e={type:"image",message:"Add a game image"};else if(!d)e={type:"name",message:"Add a name for your game"};else for(const r in c){const t=r==0?"first":r==1?"second":"third",{name:s,image:o,coords:f}=c[r];if(s)if(o.file){if(!f.x||!f.y){e={type:`character${r}`,message:`Set position of ${t} character in image`};break}}else{e={type:`character${r}`,message:`Add an image for ${t} character`};break}else{e={type:`character${r}`,message:`Add a name for ${t} character`};break}}return e?(h({...e,isLunching:!0}),!0):!1}async function z(e){if(e.preventDefault(),P())return;const t=await V({name:d,image:n.file}),s=b.current.scrollWidth,o=b.current.scrollHeight;await Promise.all(c.map(({name:f,image:q,coords:L})=>X({name:f,image:q.file,coords:{x:L.x/s,y:L.y/o}},t))),await Y(k.id,t),E("/")}function F(e){v({file:e,url:URL.createObjectURL(e)})}return u("div",{className:"h-[90%] p-10 pt-4 flex justify-center gap-4",children:[u(J,{className:"flex-[0.8] relative",dragOverClass:"dragOver",onDrop:F,children:[a(K,{className:"bg-red-600",active:i==null?void 0:i.isLunching,message:i.message,onClose:()=>h(e=>({...e,isLunching:null})),ms:3e3}),a("div",{ref:N,className:"h-full w-full overflow-y-scroll overflow-x-hidden relative z-0",children:n.url?a(M,{ref:b,image:n.url,containerRef:N,x:g,y:p,onClick:A,onResize:G,children:g&&p&&a(Q,{x:g,y:p})}):a("div",{className:"flex flex-col justify-center items-center w-full h-full cursor-pointer group",onClick:S,children:u("div",{className:"drop w-1/2 p-10 border-4 border-transparent border-dashed rounded-xl group-hover:border-white",children:[a("img",{className:"mb-4",src:ee,alt:"illustration with images folder"}),a("p",{className:"text-center font-semibold text-2xl text-tiber-500",children:"Select or drop an image that it contains your characters"})]})})})]}),u("form",{className:"flex-[0.2] flex flex-col gap-4 text-white bg-tiber-500 rounded-xl p-4",onSubmit:z,children:[a(C,{label:"Game Image",children:u("div",{className:`flex items-center gap-4 px-2 py-1 rounded border-2 ${i.type==="image"?"border-red-600":"border-transparent"} transition-all duration-300 cursor-pointer hover:bg-[hsla(0,0%,100%,0.2)]`,onClick:S,children:[a("input",{ref:w,className:"hidden",type:"file",accept:"image/*",onChange:U}),a("img",{src:_,alt:"Image icon"}),a("span",{children:(R=(I=n.file)==null?void 0:I.name)!=null?R:"Chose image"})]})}),a(C,{label:"Game name",children:a("input",{className:`text-tiber-500 p-1 rounded border-2 ${i.type==="name"?"border-red-600":""}`,placeholder:"Name...",type:"text",value:d,onChange:e=>j(e.target.value)})}),a(C,{label:"Characters",children:a("ul",{className:"flex flex-col gap-3",children:c.map((e,r)=>a(T,{character:e,isSelected:m===r,onChange:O(r),onSelect:D(r),hasError:i.type===`character${r}`},r))})}),a("button",{className:"mt-auto",type:"submit",children:"Create"})]})]})}const le=Z(ae);export{le as default};
