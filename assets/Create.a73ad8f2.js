import{u as W}from"./useGameImage.7482bad4.js";import{w as J,b as K,r as n,c as M,d as u,m as Q,j as r,P as T,h as V,S as X,C,n as Y,B as Z,o as _,p as ee,q as ae}from"./index.24d213bf.js";const re="/where-is-game/assets/Image.27eaf308.svg",te="/where-is-game/assets/imageIllustration.062f45da.svg",se={name:"",coords:{x:null,y:null},image:{file:null,url:""}};function ne(){var L,I;const{user:k}=K(),[i,h]=n.exports.useState({message:"Error",type:"",isLunching:null}),[m,$]=n.exports.useState(0),[c,y]=n.exports.useState(new Array(3).fill({...se})),[s,v]=n.exports.useState({file:null,url:""}),w=n.exports.useRef(),[d,j]=n.exports.useState(""),{x:g,y:p,setCoords:x,containerRef:N,imageRef:b}=W(c[m]),E=M(),[U,A]=n.exports.useState(!1);n.exports.useEffect(()=>()=>URL.revokeObjectURL(s.url),[s.file]),n.exports.useEffect(()=>{h(e=>({...e,type:"",isLunching:null}))},[s.file,d,c]);function S(){w.current.click()}function G(e){const a=e.target.files[0];!a||v({file:a,url:URL.createObjectURL(a)})}function O(e){m!=null&&s.url&&(y(a=>a.map((t,l)=>l!==m?t:{...t,coords:e})),x(e))}function D(e){x(e)}function P(e){return function(a){y(t=>t.map((l,o)=>o!==e?l:{...l,...a}))}}function z(e){return function(a){$(e),x(a)}}function F(){let e=null;if(!s.file)e={type:"image",message:"Add a game image"};else if(!d)e={type:"name",message:"Add a name for your game"};else for(const a in c){const t=a==0?"first":a==1?"second":"third",{name:l,image:o,coords:f}=c[a];if(l)if(o.file){if(!f.x||!f.y){e={type:`character${a}`,message:`Set position of ${t} character in image`};break}}else{e={type:`character${a}`,message:`Add an image for ${t} character`};break}else{e={type:`character${a}`,message:`Add a name for ${t} character`};break}}return e?(h({...e,isLunching:!0}),!0):!1}async function B(e){if(e.preventDefault(),F())return;A(!0);const t=await _({name:d,image:s.file}),l=b.current.scrollWidth,o=b.current.scrollHeight;await Promise.all(c.map(({name:f,image:H,coords:R})=>ee({name:f,image:H.file,coords:{x:R.x/l,y:R.y/o}},t))),await ae(k.id,t),E("/")}function q(e){v({file:e,url:URL.createObjectURL(e)})}return u("div",{className:"h-[90%] p-10 pt-4 flex justify-center gap-4",children:[u(Q,{className:"flex-[0.8] relative",dragOverClass:"dragOver",onDrop:q,children:[r(T,{className:"bg-red-600",active:i==null?void 0:i.isLunching,message:i.message,onClose:()=>h(e=>({...e,isLunching:null})),ms:3e3}),r("div",{ref:N,className:"h-full w-full overflow-y-scroll overflow-x-hidden relative z-0",children:s.url?r(V,{ref:b,image:s.url,containerRef:N,x:g,y:p,onClick:O,onResize:D,children:g&&p&&r(X,{x:g,y:p})}):r("div",{className:"flex flex-col justify-center items-center w-full h-full cursor-pointer group",onClick:S,children:u("div",{className:"drop w-1/2 p-10 border-4 border-transparent border-dashed rounded-xl group-hover:border-white",children:[r("img",{className:"mb-4",src:te,alt:"illustration with images folder"}),r("p",{className:"text-center font-semibold text-2xl text-tiber-500",children:"Select or drop an image that it contains your characters"})]})})})]}),u("form",{className:"flex-[0.2] flex flex-col gap-4 text-white bg-tiber-500 rounded-xl p-4",onSubmit:B,children:[r(C,{label:"Game Image",children:u("div",{className:`flex items-center gap-4 px-2 py-1 rounded border-2 ${i.type==="image"?"border-red-600":"border-transparent"} transition-all duration-300 cursor-pointer hover:bg-[hsla(0,0%,100%,0.2)]`,onClick:S,children:[r("input",{ref:w,className:"hidden",type:"file",accept:"image/*",onChange:G}),r("img",{src:re,alt:"Image icon"}),r("span",{children:(I=(L=s.file)==null?void 0:L.name)!=null?I:"Chose image"})]})}),r(C,{label:"Game name",children:r("input",{className:`text-tiber-500 p-1 rounded border-2 ${i.type==="name"?"border-red-600":""}`,placeholder:"Name...",type:"text",value:d,onChange:e=>j(e.target.value)})}),r(C,{label:"Characters",children:r("ul",{className:"flex flex-col gap-3",children:c.map((e,a)=>r(Y,{character:e,isSelected:m===a,onChange:P(a),onSelect:z(a),hasError:i.type===`character${a}`},a))})}),r(Z,{isLoading:U,className:"mt-auto",children:"Create"})]})]})}const ce=J(ne);export{ce as default};
