import{u as H}from"./useGameImage.0331a174.js";import{r as l,l as W,b as m,m as q,j as a,P as B,d as J,S as K,C as y,n as M,o as Q,p as T}from"./index.1a5e24ee.js";const V="/assets/Image.27eaf308.svg",X="/assets/imageIllustration.062f45da.svg",Y={name:"",coords:{x:null,y:null},image:{file:null,url:""}};function ee(){var I,R;const[i,h]=l.exports.useState({message:"Error",type:"",isLunching:null}),[d,L]=l.exports.useState(0),[c,C]=l.exports.useState(new Array(3).fill({...Y})),[n,v]=l.exports.useState({file:null,url:""}),N=l.exports.useRef(),[f,k]=l.exports.useState(""),{x:g,y:p,setCoords:x,containerRef:S,imageRef:b}=H(c[d]),$=W();l.exports.useEffect(()=>()=>URL.revokeObjectURL(n.url),[n.file]),l.exports.useEffect(()=>{h(e=>({...e,type:"",isLunching:null}))},[n.file,f,c]);function w(){N.current.click()}function j(e){const r=e.target.files[0];!r||v({file:r,url:URL.createObjectURL(r)})}function E(e){d!=null&&n.url&&(C(r=>r.map((t,s)=>s!==d?t:{...t,coords:e})),x(e))}function U(e){x(e)}function O(e){return function(r){C(t=>t.map((s,o)=>o!==e?s:{...s,...r}))}}function A(e){return function(r){L(e),x(r)}}function G(){let e=null;if(!n.file)e={type:"image",message:"Add a game image"};else if(!f)e={type:"name",message:"Add a name for your game"};else for(const r in c){const t=r==0?"first":r==1?"second":"third",{name:s,image:o,coords:u}=c[r];if(s)if(o.file){if(!u.x||!u.y){e={type:`character${r}`,message:`Set position of ${t} character in image`};break}}else{e={type:`character${r}`,message:`Add an image for ${t} character`};break}else{e={type:`character${r}`,message:`Add a name for ${t} character`};break}}return e?(h({...e,isLunching:!0}),!0):!1}async function D(e){if(e.preventDefault(),G())return;const t=await Q({name:f,image:n.file});for(const{name:s,image:o,coords:u}of c){const F=b.current.scrollWidth,P=b.current.scrollHeight;await T({name:s,image:o.file,coords:{x:u.x/F,y:u.y/P}},t)}$("/")}function z(e){v({file:e,url:URL.createObjectURL(e)})}return m("div",{className:"h-[90%] p-10 pt-4 flex justify-center gap-4",children:[m(q,{className:"flex-[0.8] relative",dragOverClass:"dragOver",onDrop:z,children:[a(B,{className:"bg-red-600",active:i==null?void 0:i.isLunching,message:i.message,onClose:()=>h(e=>({...e,isLunching:null})),ms:3e3}),a("div",{ref:S,className:"h-full w-full overflow-y-scroll overflow-x-hidden relative z-0",children:n.url?a(J,{ref:b,image:n.url,containerRef:S,x:g,y:p,onClick:E,onResize:U,children:g&&p&&a(K,{x:g,y:p})}):a("div",{className:"flex flex-col justify-center items-center w-full h-full cursor-pointer group",onClick:w,children:m("div",{className:"drop w-1/2 p-10 border-4 border-transparent border-dashed rounded-xl group-hover:border-white",children:[a("img",{className:"mb-4",src:X,alt:"illustration with images folder"}),a("p",{className:"text-center font-semibold text-2xl text-tiber",children:"Select or drop an image that it contains your characters"})]})})})]}),m("form",{className:"flex-[0.2] flex flex-col gap-4 text-white bg-tiber rounded-xl p-4",onSubmit:D,children:[a(y,{label:"Game Image",children:m("div",{className:`flex items-center gap-4 px-2 py-1 rounded border-2 ${i.type==="image"?"border-red-600":"border-transparent"} transition-all duration-300 cursor-pointer hover:bg-[hsla(0,0%,100%,0.2)]`,onClick:w,children:[a("input",{ref:N,className:"hidden",type:"file",accept:"image/*",onChange:j}),a("img",{src:V,alt:"Image icon"}),a("span",{children:(R=(I=n.file)==null?void 0:I.name)!=null?R:"Chose image"})]})}),a(y,{label:"Game name",children:a("input",{className:`text-tiber p-1 rounded border-2 ${i.type==="name"?"border-red-600":""}`,placeholder:"Name...",type:"text",value:f,onChange:e=>k(e.target.value)})}),a(y,{label:"Characters",children:a("ul",{className:"flex flex-col gap-3",children:c.map((e,r)=>a(M,{character:e,isSelected:d===r,onChange:O(r),onSelect:A(r),hasError:i.type===`character${r}`},r))})}),a("button",{className:"mt-auto",type:"submit",children:"Create"})]})]})}export{ee as default};
